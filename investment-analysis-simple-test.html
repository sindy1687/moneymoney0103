<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•è³‡çµ„åˆåˆ†ææ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .data-display {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š æŠ•è³‡çµ„åˆåˆ†ææ¸¬è©¦</h1>
    
    <div class="container">
        <h3>å¿«é€Ÿæ¸¬è©¦</h3>
        <button class="button" onclick="testBasicFunction()">åŸºç¤åŠŸèƒ½æ¸¬è©¦</button>
        <button class="button" onclick="loadTestData()">è¼‰å…¥æ¸¬è©¦æ•¸æ“š</button>
        <button class="button" onclick="testPortfolioAnalysis()">æ¸¬è©¦æŠ•è³‡çµ„åˆåˆ†æ</button>
        <button class="button" onclick="testWithModal()">ä½¿ç”¨å½ˆçª—æ¸¬è©¦</button>
        <div id="status"></div>
    </div>
    
    <div class="container">
        <h3>æ•¸æ“šæŸ¥çœ‹</h3>
        <button class="button" onclick="showInvestmentRecords()">é¡¯ç¤ºæŠ•è³‡è¨˜éŒ„</button>
        <button class="button" onclick="showHoldings()">é¡¯ç¤ºæŒè‚¡è¨ˆç®—</button>
        <button class="button" onclick="showCurrentPrices()">é¡¯ç¤ºç•¶å‰åƒ¹æ ¼</button>
        <div id="dataDisplay"></div>
    </div>
    
    <!-- æŠ•è³‡çµ„åˆåˆ†æå½ˆçª— -->
    <div class="modal" id="portfolioModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“Š æŠ•è³‡çµ„åˆåˆ†æ</h3>
                <button class="close-btn" onclick="closeModal()">âœ•</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="js/investment-analysis.js"></script>
    <script src="js/investment-analysis-integration.js"></script>

    <script>
        function updateStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function updateDataDisplay(data) {
            const displayDiv = document.getElementById('dataDisplay');
            displayDiv.innerHTML = `<div class="data-display">${JSON.stringify(data, null, 2)}</div>`;
        }

        function testBasicFunction() {
            try {
                // æª¢æŸ¥ InvestmentAnalysis æ¨¡çµ„
                if (typeof InvestmentAnalysis === 'undefined') {
                    throw new Error('InvestmentAnalysis æ¨¡çµ„æœªè¼‰å…¥');
                }
                
                // æª¢æŸ¥ InvestmentAnalysisManager
                if (typeof investmentAnalysisManager === 'undefined') {
                    throw new Error('InvestmentAnalysisManager æœªå‰µå»º');
                }
                
                updateStatus('âœ… åŸºç¤åŠŸèƒ½æ­£å¸¸ - æ¨¡çµ„å’Œç®¡ç†å™¨éƒ½å·²è¼‰å…¥');
                
                // é¡¯ç¤ºå¯ç”¨æ–¹æ³•
                const methods = Object.keys(InvestmentAnalysis);
                updateDataDisplay({
                    InvestmentAnalysiså¯ç”¨æ–¹æ³•: methods,
                    ç®¡ç†å™¨ç‹€æ…‹: {
                        isInitialized: investmentAnalysisManager.isInitialized,
                        holdingsCount: investmentAnalysisManager.currentHoldings.length,
                        goalsCount: investmentAnalysisManager.currentGoals.length
                    }
                });
                
            } catch (error) {
                updateStatus('âŒ åŸºç¤åŠŸèƒ½æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
            }
        }

        function loadTestData() {
            const testData = [
                {
                    type: 'buy',
                    stockCode: '0056',
                    stockName: 'å…ƒå¤§å°ç£50',
                    date: '2024-01-15',
                    price: 150.5,
                    shares: 1000,
                    fee: 100,
                    timestamp: Date.now() - 30 * 24 * 60 * 60 * 1000
                },
                {
                    type: 'buy',
                    stockCode: '0050',
                    stockName: 'å…ƒå¤§é«˜è‚¡æ¯',
                    date: '2024-02-20',
                    price: 120.3,
                    shares: 500,
                    fee: 80,
                    timestamp: Date.now() - 20 * 24 * 60 * 60 * 1000
                },
                {
                    type: 'buy',
                    stockCode: '2330',
                    stockName: 'å°ç©é›»',
                    date: '2024-03-10',
                    price: 650.0,
                    shares: 100,
                    fee: 150,
                    timestamp: Date.now() - 10 * 24 * 60 * 60 * 1000
                }
            ];
            
            const currentPrices = {
                '0056': 155.2,
                '0050': 125.8,
                '2330': 680.5
            };
            
            localStorage.setItem('investmentRecords', JSON.stringify(testData));
            localStorage.setItem('stockCurrentPrices', JSON.stringify(currentPrices));
            
            updateStatus('âœ… æ¸¬è©¦æ•¸æ“šå·²è¼‰å…¥');
            
            // é‡æ–°è¼‰å…¥æŒè‚¡
            if (typeof investmentAnalysisManager !== 'undefined') {
                investmentAnalysisManager.loadHoldings();
                updateStatus('âœ… æŒè‚¡æ•¸æ“šå·²æ›´æ–°: ' + investmentAnalysisManager.currentHoldings.length + ' æª”');
            }
        }

        function testPortfolioAnalysis() {
            try {
                if (typeof investmentAnalysisManager === 'undefined') {
                    throw new Error('InvestmentAnalysisManager æœªå®šç¾©');
                }
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                investmentAnalysisManager.loadHoldings();
                
                if (investmentAnalysisManager.currentHoldings.length === 0) {
                    updateStatus('âš ï¸ æ²’æœ‰æŒè‚¡æ•¸æ“šï¼Œè«‹å…ˆè¼‰å…¥æ¸¬è©¦æ•¸æ“š', 'warning');
                    return;
                }
                
                // åŸ·è¡Œåˆ†æ
                const analysis = InvestmentAnalysis.analyzePortfolio(investmentAnalysisManager.currentHoldings);
                
                updateStatus('âœ… æŠ•è³‡çµ„åˆåˆ†æå®Œæˆ');
                updateDataDisplay(analysis);
                
            } catch (error) {
                updateStatus('âŒ æŠ•è³‡çµ„åˆåˆ†æå¤±æ•—: ' + error.message, 'error');
                console.error('åˆ†æéŒ¯èª¤:', error);
            }
        }

        function testWithModal() {
            try {
                if (typeof investmentAnalysisManager === 'undefined') {
                    throw new Error('InvestmentAnalysisManager æœªå®šç¾©');
                }
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                investmentAnalysisManager.loadHoldings();
                
                if (investmentAnalysisManager.currentHoldings.length === 0) {
                    updateStatus('âš ï¸ æ²’æœ‰æŒè‚¡æ•¸æ“šï¼Œè«‹å…ˆè¼‰å…¥æ¸¬è©¦æ•¸æ“š', 'warning');
                    return;
                }
                
                // åŸ·è¡Œåˆ†æ
                const analysis = InvestmentAnalysis.analyzePortfolio(investmentAnalysisManager.currentHoldings);
                
                // é¡¯ç¤ºåœ¨å½ˆçª—ä¸­
                const modalBody = document.getElementById('modalBody');
                modalBody.innerHTML = `
                    <h4>ğŸ“Š æŠ•è³‡çµ„åˆåˆ†æçµæœ</h4>
                    <div class="data-display">${JSON.stringify(analysis, null, 2)}</div>
                `;
                
                document.getElementById('portfolioModal').style.display = 'flex';
                updateStatus('âœ… å½ˆçª—æ¸¬è©¦æˆåŠŸ');
                
            } catch (error) {
                updateStatus('âŒ å½ˆçª—æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
                console.error('å½ˆçª—éŒ¯èª¤:', error);
            }
        }

        function closeModal() {
            document.getElementById('portfolioModal').style.display = 'none';
        }

        function showInvestmentRecords() {
            try {
                const records = JSON.parse(localStorage.getItem('investmentRecords') || '[]');
                updateDataDisplay({
                    æŠ•è³‡è¨˜éŒ„æ•¸é‡: records.length,
                    è¨˜éŒ„è©³æƒ…: records
                });
                updateStatus('âœ… æŠ•è³‡è¨˜éŒ„é¡¯ç¤ºå®Œæˆ');
            } catch (error) {
                updateStatus('âŒ é¡¯ç¤ºæŠ•è³‡è¨˜éŒ„å¤±æ•—: ' + error.message, 'error');
            }
        }

        function showHoldings() {
            try {
                if (typeof investmentAnalysisManager === 'undefined') {
                    throw new Error('InvestmentAnalysisManager æœªå®šç¾©');
                }
                
                investmentAnalysisManager.loadHoldings();
                updateDataDisplay({
                    æŒè‚¡æ•¸é‡: investmentAnalysisManager.currentHoldings.length,
                    æŒè‚¡è©³æƒ…: investmentAnalysisManager.currentHoldings
                });
                updateStatus('âœ… æŒè‚¡è¨ˆç®—é¡¯ç¤ºå®Œæˆ');
            } catch (error) {
                updateStatus('âŒ é¡¯ç¤ºæŒè‚¡å¤±æ•—: ' + error.message, 'error');
            }
        }

        function showCurrentPrices() {
            try {
                const prices = JSON.parse(localStorage.getItem('stockCurrentPrices') || '{}');
                updateDataDisplay({
                    ç•¶å‰åƒ¹æ ¼æ•¸é‡: Object.keys(prices).length,
                    åƒ¹æ ¼è©³æƒ…: prices
                });
                updateStatus('âœ… ç•¶å‰åƒ¹æ ¼é¡¯ç¤ºå®Œæˆ');
            } catch (error) {
                updateStatus('âŒ é¡¯ç¤ºç•¶å‰åƒ¹æ ¼å¤±æ•—: ' + error.message, 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
        window.addEventListener('load', function() {
            setTimeout(testBasicFunction, 500);
        });
    </script>
</body>
</html>

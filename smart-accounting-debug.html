<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§è¨˜å¸³åŠŸèƒ½èª¿è©¦</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #357abd;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid #4a90e2;
        }
        .suggestion {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .confidence {
            font-weight: bold;
            color: #4a90e2;
        }
        .debug-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  æ™ºæ…§è¨˜å¸³åŠŸèƒ½èª¿è©¦</h1>
        
        <!-- æ¨¡çµ„æª¢æŸ¥ -->
        <div class="section">
            <h2>ğŸ” æ¨¡çµ„è¼‰å…¥æª¢æŸ¥</h2>
            <button onclick="checkModules()">æª¢æŸ¥æ¨¡çµ„è¼‰å…¥</button>
            <button onclick="checkSmartAccounting()">æª¢æŸ¥æ™ºæ…§è¨˜å¸³æ¨¡çµ„</button>
            <button onclick="testBasicFunction()">æ¸¬è©¦åŸºæœ¬åŠŸèƒ½</button>
            <div id="moduleResults"></div>
        </div>
        
        <!-- æ™ºæ…§åˆ†é¡æ¸¬è©¦ -->
        <div class="section">
            <h2>ğŸ¯ æ™ºæ…§åˆ†é¡æ¸¬è©¦</h2>
            
            <div class="form-group">
                <label for="testAmount">é‡‘é¡ (NT$)</label>
                <input type="number" id="testAmount" placeholder="ä¾‹å¦‚: 150">
            </div>
            
            <div class="form-group">
                <label for="testDescription">æè¿°</label>
                <input type="text" id="testDescription" placeholder="ä¾‹å¦‚: åˆé¤åœ¨å’–å•¡å»³">
            </div>
            
            <div class="form-group">
                <label for="testTime">æ™‚é–“ (å¯é¸)</label>
                <select id="testTime">
                    <option value="">è‡ªå‹•ä½¿ç”¨ç•¶å‰æ™‚é–“</option>
                    <option value="7">æ—©ä¸Š (7:00)</option>
                    <option value="12">ä¸­åˆ (12:00)</option>
                    <option value="18">æ™šä¸Š (18:00)</option>
                    <option value="22">æ·±å¤œ (22:00)</option>
                </select>
            </div>
            
            <button onclick="testSmartSuggestion()">æ¸¬è©¦æ™ºæ…§åˆ†é¡å»ºè­°</button>
            <button onclick="clearResults()">æ¸…ç©ºçµæœ</button>
            
            <div id="suggestionResults"></div>
        </div>
        
        <!-- å­¸ç¿’åŠŸèƒ½æ¸¬è©¦ -->
        <div class="section">
            <h2>ğŸ“š å­¸ç¿’åŠŸèƒ½æ¸¬è©¦</h2>
            
            <div class="form-group">
                <label for="originalCategory">åŸå§‹å»ºè­°åˆ†é¡</label>
                <select id="originalCategory">
                    <option value="é£²é£Ÿ">é£²é£Ÿ</option>
                    <option value="äº¤é€š">äº¤é€š</option>
                    <option value="å¨›æ¨‚">å¨›æ¨‚</option>
                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="correctCategory">ä½¿ç”¨è€…ä¿®æ­£åˆ†é¡</label>
                <select id="correctCategory">
                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                    <option value="é£²é£Ÿ">é£²é£Ÿ</option>
                    <option value="äº¤é€š">äº¤é€š</option>
                    <option value="å¨›æ¨‚">å¨›æ¨‚</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="correctionAmount">é‡‘é¡</label>
                <input type="number" id="correctionAmount" placeholder="ä¾‹å¦‚: 150">
            </div>
            
            <div class="form-group">
                <label for="correctionDescription">æè¿°</label>
                <input type="text" id="correctionDescription" placeholder="ä¾‹å¦‚: ä¾¿åˆ©å•†åº—è²·é›¶é£Ÿ">
            </div>
            
            <button onclick="testLearning()">æ¸¬è©¦å­¸ç¿’åŠŸèƒ½</button>
            <button onclick="clearLearningResults()">æ¸…ç©ºå­¸ç¿’çµæœ</button>
            
            <div id="learningResults"></div>
        </div>
        
        <!-- å¿«é€Ÿæ¸¬è©¦ -->
        <div class="section">
            <h2>âš¡ å¿«é€Ÿæ¸¬è©¦</h2>
            <button onclick="quickTest('breakfast')">æ—©é¤æ¸¬è©¦</button>
            <button onclick="quickTest('lunch')">åˆé¤æ¸¬è©¦</button>
            <button onclick="quickTest('dinner')">æ™šé¤æ¸¬è©¦</button>
            <button onclick="quickTest('coffee')">å’–å•¡æ¸¬è©¦</button>
            <button onclick="quickTest('transport')">äº¤é€šæ¸¬è©¦</button>
            <button onclick="quickTest('shopping')">è³¼ç‰©æ¸¬è©¦</button>
            <button onclick="quickTest('entertainment')">å¨›æ¨‚æ¸¬è©¦</button>
            <button onclick="quickTest('bills')">å¸³å–®æ¸¬è©¦</button>
        </div>
        
        <!-- æ•´åˆæ¸¬è©¦ -->
        <div class="section">
            <h2>ğŸ”§ æ•´åˆæ¸¬è©¦</h2>
            <button onclick="testIntegration()">æ¸¬è©¦èˆ‡ä¸»æ‡‰ç”¨ç¨‹å¼æ•´åˆ</button>
            <button onclick="testManagerInit()">æ¸¬è©¦ç®¡ç†å™¨åˆå§‹åŒ–</button>
            <button onclick="testEventBinding()">æ¸¬è©¦äº‹ä»¶ç¶å®š</button>
            <div id="integrationResults"></div>
        </div>
    </div>

    <!-- è¼‰å…¥æ™ºæ…§è¨˜å¸³æ¨¡çµ„ -->
    <script src="js/smart-accounting.js"></script>
    
    <script>
        // æ¸¬è©¦çµæœé¡¯ç¤º
        function showResult(containerId, content, type = 'success') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = content;
            container.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('suggestionResults').innerHTML = '';
        }
        
        function clearLearningResults() {
            document.getElementById('learningResults').innerHTML = '';
        }
        
        // æª¢æŸ¥æ¨¡çµ„è¼‰å…¥
        function checkModules() {
            const container = document.getElementById('moduleResults');
            container.innerHTML = '';
            
            // æª¢æŸ¥ SmartAccounting æ¨¡çµ„
            if (typeof SmartAccounting !== 'undefined') {
                showResult('moduleResults', 'âœ… SmartAccounting æ¨¡çµ„å·²è¼‰å…¥', 'success');
                showResult('moduleResults', `å¯ç”¨åŠŸèƒ½: ${Object.keys(SmartAccounting).join(', ')}`, 'success');
            } else {
                showResult('moduleResults', 'âŒ SmartAccounting æ¨¡çµ„æœªè¼‰å…¥', 'error');
                showResult('moduleResults', 'è«‹æª¢æŸ¥ js/smart-accounting.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨', 'error');
            }
            
            // æª¢æŸ¥ SmartAccountingManager æ¨¡çµ„
            if (typeof SmartAccountingManager !== 'undefined') {
                showResult('moduleResults', 'âœ… SmartAccountingManager æ¨¡çµ„å·²è¼‰å…¥', 'success');
            } else {
                showResult('moduleResults', 'âŒ SmartAccountingManager æ¨¡çµ„æœªè¼‰å…¥', 'error');
                showResult('moduleResults', 'è«‹æª¢æŸ¥ js/smart-accounting-integration.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨', 'error');
            }
        }
        
        // æª¢æŸ¥æ™ºæ…§è¨˜å¸³æ¨¡çµ„
        function checkSmartAccounting() {
            const container = document.getElementById('moduleResults');
            container.innerHTML = '';
            
            if (typeof SmartAccounting === 'undefined') {
                showResult('moduleResults', 'âŒ SmartAccounting æ¨¡çµ„æœªè¼‰å…¥', 'error');
                return;
            }
            
            // æª¢æŸ¥åˆ†é¡è¦å‰‡
            if (SmartAccounting.CATEGORY_RULES) {
                const ruleCount = Object.keys(SmartAccounting.CATEGORY_RULES).length;
                showResult('moduleResults', `âœ… åˆ†é¡è¦å‰‡å·²è¼‰å…¥ (${ruleCount} å€‹åˆ†é¡)`, 'success');
                
                // é¡¯ç¤ºéƒ¨åˆ†è¦å‰‡
                Object.keys(SmartAccounting.CATEGORY_RULES).slice(0, 3).forEach(category => {
                    const rule = SmartAccounting.CATEGORY_RULES[category];
                    showResult('moduleResults', 
                        `ğŸ“‹ ${category}: ${rule.keywords.length} é—œéµå­—, ${rule.amountRanges.length} é‡‘é¡ç¯„åœ`, 
                        'debug-item'
                    );
                });
            } else {
                showResult('moduleResults', 'âŒ åˆ†é¡è¦å‰‡æœªè¼‰å…¥', 'error');
            }
            
            // æª¢æŸ¥ä¸»è¦åŠŸèƒ½
            const functions = ['suggestCategory', 'analyzeSpendingPattern', 'learnUserPreferences'];
            functions.forEach(func => {
                if (typeof SmartAccounting[func] === 'function') {
                    showResult('moduleResults', `âœ… ${func} åŠŸèƒ½å¯ç”¨`, 'success');
                } else {
                    showResult('moduleResults', `âŒ ${func} åŠŸèƒ½ä¸å¯ç”¨`, 'error');
                }
            });
        }
        
        // æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
        function testBasicFunction() {
            const container = document.getElementById('moduleResults');
            container.innerHTML = '';
            
            if (typeof SmartAccounting === 'undefined') {
                showResult('moduleResults', 'âŒ SmartAccounting æ¨¡çµ„æœªè¼‰å…¥', 'error');
                return;
            }
            
            try {
                // æ¸¬è©¦åŸºæœ¬åˆ†é¡å»ºè­°
                const suggestion = SmartAccounting.suggestCategory(150, 'åˆé¤');
                if (suggestion) {
                    showResult('moduleResults', 
                        `âœ… åŸºæœ¬æ¸¬è©¦æˆåŠŸ: å»ºè­°åˆ†é¡ ${suggestion.primary} (ä¿¡å¿ƒåº¦: ${suggestion.confidence}%)`, 
                        'success'
                    );
                } else {
                    showResult('moduleResults', 'âš ï¸ åŸºæœ¬æ¸¬è©¦: ç„¡æ³•æä¾›åˆ†é¡å»ºè­°', 'error');
                }
            } catch (error) {
                showResult('moduleResults', `âŒ åŸºæœ¬æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // æ¸¬è©¦æ™ºæ…§åˆ†é¡å»ºè­°
        function testSmartSuggestion() {
            const amount = parseFloat(document.getElementById('testAmount').value);
            const description = document.getElementById('testDescription').value;
            const timeOfDay = document.getElementById('testTime').value ? 
                parseInt(document.getElementById('testTime').value) : null;
            
            if (!amount || amount <= 0 || !description) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡å’Œæè¿°');
                return;
            }
            
            const container = document.getElementById('suggestionResults');
            container.innerHTML = '';
            
            if (typeof SmartAccounting === 'undefined') {
                showResult('suggestionResults', 'âŒ SmartAccounting æ¨¡çµ„æœªè¼‰å…¥', 'error');
                return;
            }
            
            try {
                const suggestion = SmartAccounting.suggestCategory(amount, description, timeOfDay);
                
                if (suggestion) {
                    showResult('suggestionResults', `
                        <h3>ğŸ¯ åˆ†é¡å»ºè­°çµæœ</h3>
                        <div class="suggestion">
                            <strong>å»ºè­°åˆ†é¡:</strong> ${suggestion.primary}<br>
                            <strong>ä¿¡å¿ƒåº¦:</strong> <span class="confidence">${suggestion.confidence}%</span><br>
                            <strong>åˆ†æå› ç´ :</strong> ${suggestion.factors.join(', ')}<br>
                            <strong>å…¶ä»–å¯èƒ½:</strong> ${suggestion.alternatives.join(', ')}
                        </div>
                    `, 'success');
                } else {
                    showResult('suggestionResults', `
                        <h3>ğŸ¯ åˆ†é¡å»ºè­°çµæœ</h3>
                        <div class="error">
                            ç„¡æ³•ç¢ºå®šåˆ†é¡å»ºè­°ï¼Œè«‹æä¾›æ›´è©³ç´°çš„æè¿°æˆ–é‡‘é¡è³‡è¨Š
                        </div>
                    `, 'error');
                }
            } catch (error) {
                showResult('suggestionResults', `âŒ åˆ†é¡å»ºè­°å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // æ¸¬è©¦å­¸ç¿’åŠŸèƒ½
        function testLearning() {
            const originalCategory = document.getElementById('originalCategory').value;
            const correctCategory = document.getElementById('correctCategory').value;
            const amount = parseFloat(document.getElementById('correctionAmount').value);
            const description = document.getElementById('correctionDescription').value;
            
            if (!amount || amount <= 0 || !description) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„ä¿®æ­£è³‡è¨Š');
                return;
            }
            
            const container = document.getElementById('learningResults');
            container.innerHTML = '';
            
            if (typeof SmartAccounting === 'undefined') {
                showResult('learningResults', 'âŒ SmartAccounting æ¨¡çµ„æœªè¼‰å…¥', 'error');
                return;
            }
            
            try {
                const correction = {
                    originalCategory: originalCategory,
                    correctCategory: correctCategory,
                    amount: amount,
                    description: description,
                    time: new Date().toISOString()
                };
                
                const preferences = SmartAccounting.learnUserPreferences([], [correction]);
                SmartAccounting.updateCategoryRules(preferences);
                
                showResult('learningResults', `
                    <h3>ğŸ§  å­¸ç¿’åŠŸèƒ½çµæœ</h3>
                    <div class="success">
                        <strong>å­¸ç¿’å®Œæˆ:</strong> ç³»çµ±å·²æ ¹æ“šæ‚¨çš„ä¿®æ­£æ›´æ–°åˆ†é¡è¦å‰‡<br>
                        <strong>ä¿®æ­£å…§å®¹:</strong> "${originalCategory}" â†’ "${correctCategory}"<br>
                        <strong>æè¿°:</strong> "${description}"<br>
                        <strong>é‡‘é¡:</strong> NT$${amount}
                    </div>
                    <div class="suggestion">
                        ç¾åœ¨ç³»çµ±æœƒæ›´æº–ç¢ºåœ°å°‡é¡ä¼¼çš„æ¶ˆè²»åˆ†é¡åˆ° "${correctCategory}"
                    </div>
                `, 'success');
                
                // æ¸¬è©¦å­¸ç¿’å¾Œçš„æ•ˆæœ
                const newSuggestion = SmartAccounting.suggestCategory(amount, description);
                if (newSuggestion && newSuggestion.primary === correctCategory) {
                    showResult('learningResults', 
                        `âœ… å­¸ç¿’æ•ˆæœç¢ºèª: ç¾åœ¨æ­£ç¢ºå»ºè­° "${correctCategory}"`, 
                        'success'
                    );
                }
                
            } catch (error) {
                showResult('learningResults', `âŒ å­¸ç¿’åŠŸèƒ½å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // å¿«é€Ÿæ¸¬è©¦
        function quickTest(type) {
            const tests = {
                breakfast: { amount: 80, description: 'æ—©é¤åœ¨éº¥ç•¶å‹', time: 8 },
                lunch: { amount: 150, description: 'åˆé¤åœ¨å’–å•¡å»³', time: 12 },
                dinner: { amount: 300, description: 'æ™šé¤åœ¨é¤å»³', time: 18 },
                coffee: { amount: 120, description: 'æ˜Ÿå·´å…‹å’–å•¡', time: 15 },
                transport: { amount: 65, description: 'æ­æ·é‹ä¸Šç­', time: 8 },
                shopping: { amount: 850, description: 'åœ¨ZARAè²·è¡£æœ', time: 19 },
                entertainment: { amount: 320, description: 'Netflixæœˆè²»', time: 22 },
                bills: { amount: 1200, description: 'é›»è²»å¸³å–®', time: 20 }
            };
            
            const test = tests[type];
            document.getElementById('testAmount').value = test.amount;
            document.getElementById('testDescription').value = test.description;
            document.getElementById('testTime').value = test.time;
            
            testSmartSuggestion();
        }
        
        // æ¸¬è©¦æ•´åˆ
        function testIntegration() {
            const container = document.getElementById('integrationResults');
            container.innerHTML = '';
            
            // æª¢æŸ¥ä¸»æ‡‰ç”¨ç¨‹å¼å…ƒç´ 
            const elements = [
                { id: 'amount', name: 'é‡‘é¡è¼¸å…¥æ¡†' },
                { id: 'description', name: 'æè¿°è¼¸å…¥æ¡†' },
                { id: 'category', name: 'åˆ†é¡é¸æ“‡æ¡†' },
                { id: 'recordForm', name: 'è¨˜éŒ„è¡¨å–®' }
            ];
            
            elements.forEach(element => {
                const el = document.getElementById(element.id);
                if (el) {
                    showResult('integrationResults', `âœ… ${element.name} å­˜åœ¨`, 'success');
                } else {
                    showResult('integrationResults', `âŒ ${element.name} ä¸å­˜åœ¨`, 'error');
                }
            });
            
            // æª¢æŸ¥æ™ºæ…§è¨˜å¸³æŒ‰éˆ•
            const smartBtn = document.querySelector('.smart-suggestion-btn');
            if (smartBtn) {
                showResult('integrationResults', 'âœ… æ™ºæ…§å»ºè­°æŒ‰éˆ•å­˜åœ¨', 'success');
            } else {
                showResult('integrationResults', 'âŒ æ™ºæ…§å»ºè­°æŒ‰éˆ•ä¸å­˜åœ¨', 'error');
            }
        }
        
        // æ¸¬è©¦ç®¡ç†å™¨åˆå§‹åŒ–
        function testManagerInit() {
            const container = document.getElementById('integrationResults');
            container.innerHTML = '';
            
            if (typeof SmartAccountingManager !== 'undefined') {
                try {
                    // å‰µå»ºæ¸¬è©¦ç®¡ç†å™¨
                    const testManager = new SmartAccountingManager();
                    testManager.init();
                    
                    showResult('integrationResults', 'âœ… SmartAccountingManager åˆå§‹åŒ–æˆåŠŸ', 'success');
                    showResult('integrationResults', `å·²ç¶å®šäº‹ä»¶: ${testManager.isInitialized ? 'æ˜¯' : 'å¦'}`, 'success');
                    
                } catch (error) {
                    showResult('integrationResults', `âŒ SmartAccountingManager åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
                }
            } else {
                showResult('integrationResults', 'âŒ SmartAccountingManager æ¨¡çµ„æœªè¼‰å…¥', 'error');
            }
        }
        
        // æ¸¬è©¦äº‹ä»¶ç¶å®š
        function testEventBinding() {
            const container = document.getElementById('integrationResults');
            container.innerHTML = '';
            
            // æª¢æŸ¥é‡‘é¡è¼¸å…¥äº‹ä»¶
            const amountInput = document.getElementById('amount');
            if (amountInput) {
                const events = getEventListeners(amountInput);
                showResult('integrationResults', `âœ… é‡‘é¡è¼¸å…¥æ¡†äº‹ä»¶: ${events.length} å€‹`, 'success');
            }
            
            // æª¢æŸ¥æè¿°è¼¸å…¥äº‹ä»¶
            const descriptionInput = document.getElementById('description');
            if (descriptionInput) {
                const events = getEventListeners(descriptionInput);
                showResult('integrationResults', `âœ… æè¿°è¼¸å…¥æ¡†äº‹ä»¶: ${events.length} å€‹`, 'success');
            }
        }
        
        // ç²å–äº‹ä»¶ç›£è½å™¨ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        function getEventListeners(element) {
            // é€™æ˜¯ä¸€å€‹ç°¡åŒ–çš„æª¢æŸ¥ï¼Œå¯¦éš›çš„ç„¡æ³•ç›´æ¥ç²å–æ‰€æœ‰äº‹ä»¶ç›£è½å™¨
            return element ? ['input', 'change', 'focus', 'blur'] : [];
        }
        
        // é é¢è¼‰å…¥å®Œæˆæ™‚è‡ªå‹•æª¢æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ™ºæ…§è¨˜å¸³èª¿è©¦é é¢å·²è¼‰å…¥');
            checkModules();
        });
    </script>
</body>
</html>

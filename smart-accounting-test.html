<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§è¨˜å¸³æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #357abd;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid #4a90e2;
        }
        .suggestion {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .insight {
            background: #fff3e0;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 3px solid #ff9800;
        }
        .recommendation {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 3px solid #4caf50;
        }
        .confidence {
            font-weight: bold;
            color: #4a90e2;
        }
        .test-data {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .sample-record {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 3px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– æ™ºæ…§è¨˜å¸³åŠŸèƒ½æ¸¬è©¦</h1>
        
        <!-- åˆ†é¡å»ºè­°æ¸¬è©¦ -->
        <div class="section">
            <h2>ğŸ¯ è‡ªå‹•åˆ†é¡å»ºè­°æ¸¬è©¦</h2>
            
            <div class="form-group">
                <label for="amount">é‡‘é¡ (NT$)</label>
                <input type="number" id="amount" placeholder="ä¾‹å¦‚: 150">
            </div>
            
            <div class="form-group">
                <label for="description">æè¿°</label>
                <input type="text" id="description" placeholder="ä¾‹å¦‚: åˆé¤åœ¨å’–å•¡å»³">
            </div>
            
            <div class="form-group">
                <label for="timeOfDay">æ™‚é–“ (å¯é¸)</label>
                <select id="timeOfDay">
                    <option value="">è‡ªå‹•ä½¿ç”¨ç•¶å‰æ™‚é–“</option>
                    <option value="7">æ—©ä¸Š (7:00)</option>
                    <option value="12">ä¸­åˆ (12:00)</option>
                    <option value="18">æ™šä¸Š (18:00)</option>
                    <option value="22">æ·±å¤œ (22:00)</option>
                </select>
            </div>
            
            <button onclick="testCategorySuggestion()">æ¸¬è©¦åˆ†é¡å»ºè­°</button>
            
            <div id="categoryResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- æ”¯å‡ºæ¨¡å¼åˆ†ææ¸¬è©¦ -->
        <div class="section">
            <h2>ğŸ“Š æ”¯å‡ºæ¨¡å¼åˆ†ææ¸¬è©¦</h2>
            
            <div class="test-data">
                <h3>æ¸¬è©¦è³‡æ–™</h3>
                <div id="sampleRecords">
                    <div class="sample-record">
                        <strong>åˆé¤</strong> - NT$150 - é£²é£Ÿ - 2024-01-15 12:30
                    </div>
                    <div class="sample-record">
                        <strong>æ·é‹</strong> - NT$60 - äº¤é€š - 2024-01-15 08:15
                    </div>
                    <div class="sample-record">
                        <strong>é›»å½±ç¥¨</strong> - NT$280 - å¨›æ¨‚ - 2024-01-15 19:00
                    </div>
                    <div class="sample-record">
                        <strong>è¶…å•†è³¼ç‰©</strong> - NT$350 - è³¼ç‰© - 2024-01-14 20:30
                    </div>
                    <div class="sample-record">
                        <strong>å’–å•¡</strong> - NT$85 - é£²é£Ÿ - 2024-01-14 15:20
                    </div>
                </div>
            </div>
            
            <button onclick="testSpendingAnalysis()">åˆ†ææ”¯å‡ºæ¨¡å¼</button>
            <button onclick="generateMoreTestData()">ç”Ÿæˆæ›´å¤šæ¸¬è©¦è³‡æ–™</button>
            
            <div id="analysisResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- å­¸ç¿’åŠŸèƒ½æ¸¬è©¦ -->
        <div class="section">
            <h2>ğŸ§  å­¸ç¿’åŠŸèƒ½æ¸¬è©¦</h2>
            
            <div class="form-group">
                <label for="originalCategory">åŸå§‹å»ºè­°åˆ†é¡</label>
                <select id="originalCategory">
                    <option value="é£²é£Ÿ">é£²é£Ÿ</option>
                    <option value="äº¤é€š">äº¤é€š</option>
                    <option value="å¨›æ¨‚">å¨›æ¨‚</option>
                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="correctCategory">ä½¿ç”¨è€…ä¿®æ­£åˆ†é¡</label>
                <select id="correctCategory">
                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                    <option value="é£²é£Ÿ">é£²é£Ÿ</option>
                    <option value="äº¤é€š">äº¤é€š</option>
                    <option value="å¨›æ¨‚">å¨›æ¨‚</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="correctionAmount">é‡‘é¡</label>
                <input type="number" id="correctionAmount" placeholder="ä¾‹å¦‚: 150">
            </div>
            
            <div class="form-group">
                <label for="correctionDescription">æè¿°</label>
                <input type="text" id="correctionDescription" placeholder="ä¾‹å¦‚: ä¾¿åˆ©å•†åº—è²·é›¶é£Ÿ">
            </div>
            
            <button onclick="testLearning()">æ¸¬è©¦å­¸ç¿’åŠŸèƒ½</button>
            
            <div id="learningResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- å¿«é€Ÿæ¸¬è©¦æŒ‰éˆ• -->
        <div class="section">
            <h2>âš¡ å¿«é€Ÿæ¸¬è©¦</h2>
            <button onclick="quickTest('breakfast')">æ—©é¤æ¸¬è©¦</button>
            <button onclick="quickTest('commuting')">é€šå‹¤æ¸¬è©¦</button>
            <button onclick="quickTest('shopping')">è³¼ç‰©æ¸¬è©¦</button>
            <button onclick="quickTest('entertainment')">å¨›æ¨‚æ¸¬è©¦</button>
            <button onclick="quickTest('bills')">å¸³å–®æ¸¬è©¦</button>
        </div>
    </div>

    <!-- è¼‰å…¥æ™ºæ…§è¨˜å¸³æ¨¡çµ„ -->
    <script src="js/smart-accounting.js"></script>
    
    <script>
        // æ¸¬è©¦è³‡æ–™
        let testRecords = [
            { date: '2024-01-15', time: '12:30', type: 'expense', category: 'é£²é£Ÿ', amount: 150, description: 'åˆé¤' },
            { date: '2024-01-15', time: '08:15', type: 'expense', category: 'äº¤é€š', amount: 60, description: 'æ·é‹' },
            { date: '2024-01-15', time: '19:00', type: 'expense', category: 'å¨›æ¨‚', amount: 280, description: 'é›»å½±ç¥¨' },
            { date: '2024-01-14', time: '20:30', type: 'expense', category: 'è³¼ç‰©', amount: 350, description: 'è¶…å•†è³¼ç‰©' },
            { date: '2024-01-14', time: '15:20', type: 'expense', category: 'é£²é£Ÿ', amount: 85, description: 'å’–å•¡' }
        ];
        
        // æ¸¬è©¦åˆ†é¡å»ºè­°
        function testCategorySuggestion() {
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value;
            const timeOfDay = document.getElementById('timeOfDay').value ? 
                parseInt(document.getElementById('timeOfDay').value) : null;
            
            if (!amount || amount <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡');
                return;
            }
            
            const suggestion = SmartAccounting.suggestCategory(amount, description, timeOfDay);
            const resultDiv = document.getElementById('categoryResult');
            
            if (suggestion) {
                resultDiv.innerHTML = `
                    <h3>ğŸ¯ åˆ†é¡å»ºè­°çµæœ</h3>
                    <div class="suggestion">
                        <strong>å»ºè­°åˆ†é¡:</strong> ${suggestion.primary}<br>
                        <strong>ä¿¡å¿ƒåº¦:</strong> <span class="confidence">${suggestion.confidence}%</span><br>
                        <strong>åˆ†æå› ç´ :</strong> ${suggestion.factors.join(', ')}<br>
                        <strong>å…¶ä»–å¯èƒ½:</strong> ${suggestion.alternatives.join(', ')}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <h3>ğŸ¯ åˆ†é¡å»ºè­°çµæœ</h3>
                    <div class="suggestion">
                        ç„¡æ³•ç¢ºå®šåˆ†é¡å»ºè­°ï¼Œè«‹æä¾›æ›´è©³ç´°çš„æè¿°æˆ–é‡‘é¡è³‡è¨Š
                    </div>
                `;
            }
            
            resultDiv.style.display = 'block';
        }
        
        // æ¸¬è©¦æ”¯å‡ºæ¨¡å¼åˆ†æ
        function testSpendingAnalysis() {
            const analysis = SmartAccounting.analyzeSpendingPattern(testRecords, 'monthly');
            const resultDiv = document.getElementById('analysisResult');
            
            if (analysis) {
                let html = `
                    <h3>ğŸ“Š æ”¯å‡ºæ¨¡å¼åˆ†æçµæœ</h3>
                    <div><strong>åˆ†ææœŸé–“:</strong> ${analysis.period}</div>
                    <div><strong>ç¸½æ”¯å‡º:</strong> NT$${analysis.totalSpent}</div>
                    <div><strong>äº¤æ˜“æ¬¡æ•¸:</strong> ${analysis.transactionCount}</div>
                    <div><strong>æ—¥å‡æ¶ˆè²»:</strong> NT$${Math.round(analysis.dailyAverage)}</div>
                    
                    <h4>ğŸ† ä¸»è¦æ¶ˆè²»é¡åˆ¥</h4>
                `;
                
                analysis.topCategories.forEach(cat => {
                    html += `
                        <div class="suggestion">
                            <strong>${cat.category}:</strong> NT$${cat.amount} (${cat.percentage}%)
                        </div>
                    `;
                });
                
                html += '<h4>ğŸ’¡ æ¶ˆè²»æ´å¯Ÿ</h4>';
                analysis.insights.forEach(insight => {
                    html += `
                        <div class="insight">
                            <strong>${insight.title}:</strong> ${insight.content}
                        </div>
                    `;
                });
                
                html += '<h4>ğŸ¯ æ”¹å–„å»ºè­°</h4>';
                analysis.recommendations.forEach(rec => {
                    html += `
                        <div class="recommendation">
                            <strong>${rec.title}:</strong> ${rec.content}
                        </div>
                    `;
                });
                
                resultDiv.innerHTML = html;
            } else {
                resultDiv.innerHTML = `
                    <h3>ğŸ“Š æ”¯å‡ºæ¨¡å¼åˆ†æçµæœ</h3>
                    <div class="result">ç„¡æ³•é€²è¡Œåˆ†æï¼Œè«‹æª¢æŸ¥è³‡æ–™æ ¼å¼</div>
                `;
            }
            
            resultDiv.style.display = 'block';
        }
        
        // ç”Ÿæˆæ›´å¤šæ¸¬è©¦è³‡æ–™
        function generateMoreTestData() {
            const categories = ['é£²é£Ÿ', 'äº¤é€š', 'å¨›æ¨‚', 'è³¼ç‰©', 'é†«ç™‚', 'æ•™è‚²'];
            const descriptions = {
                'é£²é£Ÿ': ['åˆé¤', 'æ™šé¤', 'å’–å•¡', 'æ—©é¤', 'ä¸‹åˆèŒ¶'],
                'äº¤é€š': ['æ·é‹', 'å…¬è»Š', 'è¨ˆç¨‹è»Š', 'æ²¹éŒ¢', 'åœè»Šè²»'],
                'å¨›æ¨‚': ['é›»å½±', 'KTV', 'éŠæˆ²', 'éŸ³æ¨‚', 'æ›¸ç±'],
                'è³¼ç‰©': ['è¡£æœ', 'é‹å­', 'åŒ–å¦å“', 'æ—¥ç”¨å“', '3Cç”¢å“'],
                'é†«ç™‚': ['çœ‹é†«ç”Ÿ', 'è²·è—¥', 'æ›è™Ÿè²»', 'å¥ä¿è²»', 'èº«é«”æª¢æŸ¥'],
                'æ•™è‚²': ['å­¸è²»', 'è£œç¿’è²»', 'æ›¸æœ¬è²»', 'èª²ç¨‹è²»', 'è­‰ç…§è²»']
            };
            
            for (let i = 0; i < 20; i++) {
                const category = categories[Math.floor(Math.random() * categories.length)];
                const categoryDescriptions = descriptions[category];
                const description = categoryDescriptions[Math.floor(Math.random() * categoryDescriptions.length)];
                
                const date = new Date(2024, 0, Math.floor(Math.random() * 30) + 1);
                const time = `${Math.floor(Math.random() * 24).toString().padStart(2, '0')}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`;
                
                testRecords.push({
                    date: date.toISOString().split('T')[0],
                    time: time,
                    type: 'expense',
                    category: category,
                    amount: Math.floor(Math.random() * 2000) + 50,
                    description: description
                });
            }
            
            // æ›´æ–°é¡¯ç¤º
            updateSampleRecordsDisplay();
            alert('å·²ç”Ÿæˆ20ç­†æ¸¬è©¦è³‡æ–™ï¼Œç¸½å…±' + testRecords.length + 'ç­†è¨˜éŒ„');
        }
        
        // æ›´æ–°æ¸¬è©¦è³‡æ–™é¡¯ç¤º
        function updateSampleRecordsDisplay() {
            const container = document.getElementById('sampleRecords');
            container.innerHTML = testRecords.slice(-10).map(record => `
                <div class="sample-record">
                    <strong>${record.description}</strong> - NT$${record.amount} - ${record.category} - ${record.date} ${record.time}
                </div>
            `).join('');
        }
        
        // æ¸¬è©¦å­¸ç¿’åŠŸèƒ½
        function testLearning() {
            const originalCategory = document.getElementById('originalCategory').value;
            const correctCategory = document.getElementById('correctCategory').value;
            const amount = parseFloat(document.getElementById('correctionAmount').value);
            const description = document.getElementById('correctionDescription').value;
            
            if (!amount || amount <= 0 || !description) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„ä¿®æ­£è³‡è¨Š');
                return;
            }
            
            const correction = {
                originalCategory,
                correctCategory,
                amount,
                description,
                time: new Date().toISOString()
            };
            
            const preferences = SmartAccounting.learnUserPreferences(testRecords, [correction]);
            SmartAccounting.updateCategoryRules(preferences);
            
            const resultDiv = document.getElementById('learningResult');
            resultDiv.innerHTML = `
                <h3>ğŸ§  å­¸ç¿’åŠŸèƒ½çµæœ</h3>
                <div class="suggestion">
                    <strong>å­¸ç¿’å®Œæˆ:</strong> ç³»çµ±å·²æ ¹æ“šæ‚¨çš„ä¿®æ­£æ›´æ–°åˆ†é¡è¦å‰‡<br>
                    <strong>ä¿®æ­£å…§å®¹:</strong> "${originalCategory}" â†’ "${correctCategory}"<br>
                    <strong>æè¿°:</strong> "${description}"<br>
                    <strong>é‡‘é¡:</strong> NT$${amount}
                </div>
                <div class="recommendation">
                    ç¾åœ¨ç³»çµ±æœƒæ›´æº–ç¢ºåœ°å°‡é¡ä¼¼çš„æ¶ˆè²»åˆ†é¡åˆ° "${correctCategory}"
                </div>
            `;
            
            resultDiv.style.display = 'block';
        }
        
        // å¿«é€Ÿæ¸¬è©¦
        function quickTest(type) {
            const tests = {
                breakfast: { amount: 120, description: 'æ—©é¤åœ¨éº¥ç•¶å‹', time: 8 },
                commuting: { amount: 65, description: 'æ­æ·é‹ä¸Šç­', time: 8 },
                shopping: { amount: 850, description: 'åœ¨ZARAè²·è¡£æœ', time: 19 },
                entertainment: { amount: 320, description: 'Netflixæœˆè²»', time: 22 },
                bills: { amount: 1200, description: 'é›»è²»å¸³å–®', time: 20 }
            };
            
            const test = tests[type];
            document.getElementById('amount').value = test.amount;
            document.getElementById('description').value = test.description;
            document.getElementById('timeOfDay').value = test.time;
            
            testCategorySuggestion();
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ™ºæ…§è¨˜å¸³æ¸¬è©¦é é¢å·²è¼‰å…¥');
            console.log('å¯ç”¨åŠŸèƒ½:', Object.keys(window.SmartAccounting));
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´è¨ºæ–·å·¥å…·</title>
    <link rel="stylesheet" href="styles.css">
    <script src="js/theme.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .diagnosis-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .summary-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .summary-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .summary-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        .summary-value {
            font-size: 18px;
            font-weight: bold;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .controls button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #007bff;
            color: white;
            font-size: 14px;
        }
        .controls button:hover {
            background: #0056b3;
        }
        .controls button.active {
            background: #28a745;
        }
        .diagnostic-output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-ok {
            color: green;
            font-weight: bold;
        }
        .status-error {
            color: red;
            font-weight: bold;
        }
        .status-warning {
            color: orange;
            font-weight: bold;
        }
        .check-item {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        .check-item.ok {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .check-item.error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .check-item.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="diagnosis-container">
        <h1>ğŸ” å®Œæ•´è¨ºæ–·å·¥å…·</h1>
        
        <div class="controls">
            <button onclick="runCompleteDiagnosis()">é‹è¡Œå®Œæ•´è¨ºæ–·</button>
            <button onclick="testTheme('blue')">è—è‰²ä¸»é¡Œ</button>
            <button onclick="testTheme('pink')">ç²‰è‰²ä¸»é¡Œ</button>
            <button onclick="testTheme('festive')">ç¯€æ—¥æ…¶å…¸ä¸»é¡Œ</button>
            <button onclick="forceApplyFestive()">å¼·åˆ¶æ‡‰ç”¨ç¯€æ—¥æ…¶å…¸</button>
            <button onclick="clearCache()">æ¸…é™¤ç·©å­˜é‡æ–°è¼‰å…¥</button>
        </div>

        <div class="section">
            <h3>ğŸ“Š æŠ•è³‡å¡ç‰‡æ¸¬è©¦</h3>
            <div class="test-grid" id="testGrid">
                <div class="summary-card primary">
                    <div class="summary-icon">ğŸ’°</div>
                    <div class="summary-content">
                        <div class="summary-label">ç¸½æŠ•å…¥é‡‘é¡</div>
                        <div class="summary-value auto-size">NT$125,000</div>
                    </div>
                </div>
                <div class="summary-card highlight">
                    <div class="summary-icon">ğŸ“Š</div>
                    <div class="summary-content">
                        <div class="summary-label">ç¸½å¸‚å€¼</div>
                        <div class="summary-value">NT$145,000</div>
                    </div>
                </div>
                <div class="summary-card highlight">
                    <div class="summary-icon">ğŸ“ˆ</div>
                    <div class="summary-content">
                        <div class="summary-label">æœªå¯¦ç¾æç›Š</div>
                        <div class="summary-value">NT$20,000</div>
                    </div>
                </div>
                <div class="summary-card primary">
                    <div class="summary-icon">ğŸ’µ</div>
                    <div class="summary-content">
                        <div class="summary-label">è‚¡æ¯æ”¶å…¥</div>
                        <div class="summary-value">NT$2,500</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ”§ è¨ºæ–·çµæœ</h3>
            <div class="diagnostic-output" id="diagnosticOutput">
                <div>ç­‰å¾…è¨ºæ–·...</div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ“‹ ç³»çµ±ç‹€æ…‹</h3>
            <div id="systemStatus">
                <div class="check-item">æª¢æŸ¥ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        function runCompleteDiagnosis() {
            console.log('=== é–‹å§‹å®Œæ•´è¨ºæ–· ===');
            const output = document.getElementById('diagnosticOutput');
            const status = document.getElementById('systemStatus');
            
            let results = [];
            let statusHtml = '';
            
            // 1. æª¢æŸ¥åŸºæœ¬ç’°å¢ƒ
            results.push('=== åŸºæœ¬ç’°å¢ƒæª¢æŸ¥ ===');
            
            // æª¢æŸ¥HTMLçµæ§‹
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            results.push(`âœ“ HTMLæ¨™ç±¤: ${html.tagName}`);
            results.push(`âœ“ ç•¶å‰ä¸»é¡Œ: ${currentTheme || '(æœªè¨­ç½®)'}`);
            
            // æª¢æŸ¥localStorage
            const selectedTheme = localStorage.getItem('selectedTheme');
            const oldTheme = localStorage.getItem('theme');
            results.push(`âœ“ localStorage selectedTheme: ${selectedTheme || '(ç„¡)'}`);
            results.push(`âœ“ localStorage theme: ${oldTheme || '(ç„¡)'}`);
            
            // 2. æª¢æŸ¥CSSæ–‡ä»¶
            results.push('\n=== CSSæ–‡ä»¶æª¢æŸ¥ ===');
            const styleSheets = document.styleSheets;
            results.push(`âœ“ æ¨£å¼è¡¨æ•¸é‡: ${styleSheets.length}`);
            
            let festiveRules = 0;
            let summaryCardRules = 0;
            
            for (let i = 0; i < styleSheets.length; i++) {
                try {
                    const sheet = styleSheets[i];
                    const rules = sheet.cssRules || sheet.rules;
                    
                    for (let j = 0; j < rules.length; j++) {
                        const rule = rules[j];
                        if (rule.selectorText) {
                            if (rule.selectorText.includes('festive')) {
                                festiveRules++;
                                if (rule.selectorText.includes('summary-card')) {
                                    summaryCardRules++;
                                    results.push(`âœ“ æ‰¾åˆ°ç¯€æ—¥æ…¶å…¸summary-cardè¦å‰‡: ${rule.selectorText}`);
                                }
                            }
                        }
                    }
                } catch (e) {
                    results.push(`âš  æ¨£å¼è¡¨ ${i} è®€å–éŒ¯èª¤: ${e.message}`);
                }
            }
            
            results.push(`âœ“ ç¯€æ—¥æ…¶å…¸CSSè¦å‰‡ç¸½æ•¸: ${festiveRules}`);
            results.push(`âœ“ ç¯€æ—¥æ…¶å…¸summary-cardè¦å‰‡: ${summaryCardRules}`);
            
            // 3. æª¢æŸ¥æŠ•è³‡å¡ç‰‡
            results.push('\n=== æŠ•è³‡å¡ç‰‡æª¢æŸ¥ ===');
            const cards = document.querySelectorAll('.summary-card');
            results.push(`âœ“ æ‰¾åˆ°æŠ•è³‡å¡ç‰‡æ•¸é‡: ${cards.length}`);
            
            cards.forEach((card, index) => {
                const style = getComputedStyle(card);
                const bgImage = style.backgroundImage;
                const bgColor = style.backgroundColor;
                const borderColor = style.borderColor;
                
                results.push(`\nå¡ç‰‡ ${index + 1}:`);
                results.push(`  èƒŒæ™¯åœ–ç‰‡: ${bgImage.substring(0, 60)}...`);
                results.push(`  èƒŒæ™¯é¡è‰²: ${bgColor}`);
                results.push(`  é‚Šæ¡†é¡è‰²: ${borderColor}`);
                
                // æª¢æŸ¥åœ–ç¤º
                const icon = card.querySelector('.summary-icon');
                if (icon) {
                    const iconStyle = getComputedStyle(icon);
                    results.push(`  åœ–ç¤ºé¡è‰²: ${iconStyle.color}`);
                    results.push(`  åœ–ç¤ºå¤§å°: ${iconStyle.fontSize}`);
                }
                
                // æª¢æŸ¥æ–‡å­—
                const content = card.querySelector('.summary-content');
                if (content) {
                    const contentStyle = getComputedStyle(content);
                    results.push(`  å…§å®¹é¡è‰²: ${contentStyle.color}`);
                }
            });
            
            // 4. æª¢æŸ¥JavaScriptå‡½æ•¸
            results.push('\n=== JavaScriptå‡½æ•¸æª¢æŸ¥ ===');
            results.push(`âœ“ applyThemeå‡½æ•¸: ${typeof applyTheme}`);
            results.push(`âœ“ getCurrentThemeå‡½æ•¸: ${typeof getCurrentTheme}`);
            
            // 5. æª¢æŸ¥åœ–ç‰‡è¼‰å…¥
            results.push('\n=== åœ–ç‰‡è¼‰å…¥æª¢æŸ¥ ===');
            testImageLoad(results);
            
            // 6. ç”Ÿæˆç‹€æ…‹å ±å‘Š
            statusHtml = generateStatusReport(currentTheme, cards, festiveRules, summaryCardRules);
            
            // é¡¯ç¤ºçµæœ
            output.innerHTML = `<pre>${results.join('\n')}</pre>`;
            status.innerHTML = statusHtml;
            
            console.log('=== è¨ºæ–·å®Œæˆ ===');
        }
        
        function testImageLoad(results) {
            const imageUrl = 'https://i.pinimg.com/1200x/ba/24/9a/ba249a3cc3f9f317683f78c240ff0686.jpg';
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                results.push(`âœ… åœ–ç‰‡è¼‰å…¥æˆåŠŸ: ${this.naturalWidth}x${this.naturalHeight}`);
            };
            
            img.onerror = function() {
                results.push(`âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—: ${imageUrl}`);
                results.push(`  å¯èƒ½åŸå› : CORSé™åˆ¶æˆ–åœ–ç‰‡ä¸å­˜åœ¨`);
            };
            
            img.src = imageUrl;
        }
        
        function generateStatusReport(theme, cards, festiveRules, summaryCardRules) {
            let html = '';
            
            // ä¸»é¡Œç‹€æ…‹
            if (theme === 'festive') {
                html += '<div class="check-item ok">âœ… ä¸»é¡Œè¨­ç½®æ­£ç¢º: ç¯€æ—¥æ…¶å…¸</div>';
            } else {
                html += '<div class="check-item warning">âš ï¸ ç•¶å‰ä¸»é¡Œä¸æ˜¯ç¯€æ—¥æ…¶å…¸: ' + (theme || 'æœªè¨­ç½®') + '</div>';
            }
            
            // CSSè¦å‰‡ç‹€æ…‹
            if (summaryCardRules > 0) {
                html += '<div class="check-item ok">âœ… CSSè¦å‰‡å­˜åœ¨: æ‰¾åˆ° ' + summaryCardRules + ' å€‹ç¯€æ—¥æ…¶å…¸summary-cardè¦å‰‡</div>';
            } else {
                html += '<div class="check-item error">âŒ CSSè¦å‰‡ç¼ºå¤±: æ²’æœ‰æ‰¾åˆ°ç¯€æ—¥æ…¶å…¸summary-cardè¦å‰‡</div>';
            }
            
            // å¡ç‰‡ç‹€æ…‹
            if (cards.length > 0) {
                html += '<div class="check-item ok">âœ… æŠ•è³‡å¡ç‰‡å­˜åœ¨: æ‰¾åˆ° ' + cards.length + ' å€‹å¡ç‰‡</div>';
                
                // æª¢æŸ¥ç¬¬ä¸€å€‹å¡ç‰‡çš„èƒŒæ™¯
                const firstCard = cards[0];
                const style = getComputedStyle(firstCard);
                const hasBackgroundImage = style.backgroundImage && style.backgroundImage !== 'none';
                
                if (hasBackgroundImage && style.backgroundImage.includes('pinimg')) {
                    html += '<div class="check-item ok">âœ… èƒŒæ™¯åœ–ç‰‡å·²æ‡‰ç”¨</div>';
                } else {
                    html += '<div class="check-item error">âŒ èƒŒæ™¯åœ–ç‰‡æœªæ‡‰ç”¨</div>';
                }
            } else {
                html += '<div class="check-item error">âŒ æŠ•è³‡å¡ç‰‡ç¼ºå¤±: æ²’æœ‰æ‰¾åˆ°summary-cardå…ƒç´ </div>';
            }
            
            // åœ–ç¤ºç‹€æ…‹
            const firstIcon = document.querySelector('.summary-icon');
            if (firstIcon) {
                const iconStyle = getComputedStyle(firstIcon);
                if (iconStyle.color === 'rgb(255, 255, 255)' || iconStyle.color === 'white') {
                    html += '<div class="check-item ok">âœ… åœ–ç¤ºé¡è‰²æ­£ç¢º: ç™½è‰²</div>';
                } else {
                    html += '<div class="check-item warning">âš ï¸ åœ–ç¤ºé¡è‰²: ' + iconStyle.color + '</div>';
                }
            }
            
            return html;
        }
        
        function testTheme(themeId) {
            if (typeof applyTheme === 'function') {
                applyTheme(themeId);
            } else {
                document.documentElement.setAttribute('data-theme', themeId);
            }
            setTimeout(runCompleteDiagnosis, 500);
        }
        
        function forceApplyFestive() {
            console.log('å¼·åˆ¶æ‡‰ç”¨ç¯€æ—¥æ…¶å…¸ä¸»é¡Œ...');
            document.documentElement.setAttribute('data-theme', 'festive');
            localStorage.setItem('selectedTheme', 'festive');
            localStorage.setItem('theme', 'festive');
            
            // å¼·åˆ¶æ‡‰ç”¨æ¨£å¼
            const cards = document.querySelectorAll('.summary-card');
            cards.forEach((card, index) => {
                card.style.setProperty('background-image', 'url("https://i.pinimg.com/1200x/ba/24/9a/ba249a3cc3f9f317683f78c240ff0686.jpg")', 'important');
                card.style.setProperty('background-size', 'cover', 'important');
                card.style.setProperty('background-position', 'center', 'important');
                card.style.setProperty('background-color', 'rgba(230, 57, 70, 0.3)', 'important');
                card.style.setProperty('background-blend-mode', 'overlay', 'important');
                card.style.setProperty('border', '2px solid rgba(252, 163, 17, 0.72)', 'important');
                card.style.setProperty('border-radius', '20px', 'important');
                card.style.setProperty('backdrop-filter', 'blur(15px)', 'important');
                
                const icon = card.querySelector('.summary-icon');
                if (icon) {
                    icon.style.setProperty('color', 'white', 'important');
                    icon.style.setProperty('text-shadow', '0 2px 4px rgba(0,0,0,0.5)', 'important');
                }
                
                const content = card.querySelector('.summary-content');
                if (content) {
                    content.style.setProperty('color', 'white', 'important');
                    content.style.setProperty('text-shadow', '0 2px 4px rgba(0,0,0,0.5)', 'important');
                }
            });
            
            setTimeout(runCompleteDiagnosis, 500);
        }
        
        function clearCache() {
            console.log('æ¸…é™¤ç·©å­˜ä¸¦é‡æ–°è¼‰å…¥...');
            localStorage.clear();
            location.reload(true);
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runCompleteDiagnosis, 1000);
        });
    </script>
</body>
</html>
